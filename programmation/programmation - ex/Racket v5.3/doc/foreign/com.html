<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text-html; charset=utf-8" /><title>5.9&nbsp;COM (Common Object Model)</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default" /><link rel="stylesheet" type="text/css" href="../racket.css" title="default" /><link rel="stylesheet" type="text/css" href="../scribble-style.css" title="default" /><script type="text/javascript" src="../scribble-common.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist" style="margin-bottom: 1em;"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" pltdoc="x">The Racket Foreign Interface</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="intro.html" class="tocviewlink" pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Loading_Foreign_Libraries.html" class="tocviewlink" pltdoc="x">Loading Foreign Libraries</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="types.html" class="tocviewlink" pltdoc="x">C Types</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="foreign_pointer-funcs.html" class="tocviewlink" pltdoc="x">Pointer Functions</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Derived_Utilities.html" class="tocviewselflink" pltdoc="x">Derived Utilities</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Miscellaneous_Support.html" class="tocviewlink" pltdoc="x">Miscellaneous Support</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="foreign_c-only.html" class="tocviewlink" pltdoc="x">Unexported Primitive Functions</a></td></tr><tr><td align="right"></td><td><a href="doc-bibliography.html" class="tocviewlink" pltdoc="x">Bibliography</a></td></tr><tr><td align="right"></td><td><a href="doc-index.html" class="tocviewlink" pltdoc="x">Index</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>5&nbsp;</td><td><a href="Derived_Utilities.html" class="tocviewlink" pltdoc="x">Derived Utilities</a></td></tr></table><div class="tocviewsublist" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.1&nbsp;</td><td><a href="homogeneous-vectors.html" class="tocviewlink" pltdoc="x">Safe Homogenous Vectors</a></td></tr><tr><td align="right">5.2&nbsp;</td><td><a href="foreign_cvector.html" class="tocviewlink" pltdoc="x">Safe C Vectors</a></td></tr><tr><td align="right">5.3&nbsp;</td><td><a href="foreign_tagged-pointers.html" class="tocviewlink" pltdoc="x">Tagged C Pointer Types</a></td></tr><tr><td align="right">5.4&nbsp;</td><td><a href="Defining_Bindings.html" class="tocviewlink" pltdoc="x">Defining Bindings</a></td></tr><tr><td align="right">5.5&nbsp;</td><td><a href="Allocation_and_Finalization.html" class="tocviewlink" pltdoc="x">Allocation and Finalization</a></td></tr><tr><td align="right">5.6&nbsp;</td><td><a href="Atomic_Execution.html" class="tocviewlink" pltdoc="x">Atomic Execution</a></td></tr><tr><td align="right">5.7&nbsp;</td><td><a href="Speculatively_Atomic_Execution.html" class="tocviewlink" pltdoc="x">Speculatively Atomic Execution</a></td></tr><tr><td align="right">5.8&nbsp;</td><td><a href="Objective-C_FFI.html" class="tocviewlink" pltdoc="x">Objective-<wbr></wbr>C FFI</a></td></tr><tr><td align="right">5.9&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">COM (Common Object Model)</a></td></tr><tr><td align="right">5.10&nbsp;</td><td><a href="file-security-guard-checks.html" class="tocviewlink" pltdoc="x">File Security-<wbr></wbr>Guard Checks</a></td></tr><tr><td align="right">5.11&nbsp;</td><td><a href="winapi.html" class="tocviewlink" pltdoc="x">Windows API Helpers</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9660;</a></td><td>5.9&nbsp;</td><td><a href="" class="tocviewselflink" pltdoc="x">COM (Common Object Model)</a></td></tr></table><div class="tocviewsublistbottom" style="display: block;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.9.1&nbsp;</td><td><a href="com-auto.html" class="tocviewlink" pltdoc="x">COM Automation</a></td></tr><tr><td align="right">5.9.2&nbsp;</td><td><a href="com-intf.html" class="tocviewlink" pltdoc="x">COM Classes and Interfaces</a></td></tr></table></div></div></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.3&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.3&quot;);">top</a></span><span class="navright"><a href="Objective-C_FFI.html" title="backward to &quot;5.8 Objective-C FFI&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Derived_Utilities.html" title="up to &quot;5 Derived Utilities&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="com-auto.html" title="forward to &quot;5.9.1 COM Automation&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>5.9<tt>&nbsp;</tt><a name="(part._com)"></a>COM (Common Object Model)</h4><p>The <a href="com-auto.html" class="RktModLink" pltdoc="x"><span class="RktSym">ffi/com</span></a> and <a href="com-intf.html" class="RktModLink" pltdoc="x"><span class="RktSym">ffi/unsafe/com</span></a>
libraries support COM interaction in two layers. The safe upper layer
provides functions for creating COM objects and dynamically
constructing method calls based on COM automatiion (i.e., reflective
information provided by the object). The unsafe lower layer provides a
syntactic form and functions for working more directly with COM
objects and interfaces.</p><p>A <a name="(tech._com._object)"></a><span style="font-style: italic">COM object</span> instantiates a particular <a name="(tech._com._clas)"></a><span style="font-style: italic">COM
class</span>. A <a href="#(tech._com._clas)" class="techoutside" pltdoc="x"><span class="techinside">COM class</span></a> can be specified in either of two ways:</p><ul><li><p>A <a name="(tech._clsid)"></a><span style="font-style: italic">CLSID</span> (class id), which is represented as a
<a href="#(tech._guid)" class="techoutside" pltdoc="x"><span class="techinside">GUID</span></a>. A <a name="(tech._guid)"></a><span style="font-style: italic">GUID</span> (globally unique identifier) is a
16-byte structure. GUIDs are typically written in string forms such
as <span class="RktVal">"{A3B0AF9E-2AB0-11D4-B6D2-0060089002FE}"</span>. The
<span class="RktSym"><a href="com-auto.html#(def._((lib._ffi/unsafe/com..rkt)._string-~3eguid))" class="RktValLink" pltdoc="x">string-&gt;guid</a></span> and <span class="RktSym"><a href="com-auto.html#(def._((lib._ffi/unsafe/com..rkt)._guid-~3estring))" class="RktValLink" pltdoc="x">guid-&gt;string</a></span> convert between
string and <a href="#(tech._guid)" class="techoutside" pltdoc="x"><span class="techinside">GUID</span></a> forms. The <span class="RktSym"><a href="com-auto.html#(def._((lib._ffi/unsafe/com..rkt)._string-~3eclsid))" class="RktValLink" pltdoc="x">string-&gt;clsid</a></span> function is
the same as <span class="RktSym"><a href="com-auto.html#(def._((lib._ffi/unsafe/com..rkt)._string-~3eguid))" class="RktValLink" pltdoc="x">string-&gt;guid</a></span>, but its use suggests that the
resulting <a href="#(tech._guid)" class="techoutside" pltdoc="x"><span class="techinside">GUID</span></a> is to be used as a <a href="#(tech._clsid)" class="techoutside" pltdoc="x"><span class="techinside">CLSID</span></a>.</p></li><li><p>A <a name="(tech._progid)"></a><span style="font-style: italic">ProgID</span> is a human-readable name, such as
<span class="RktVal">"MzCom.MzObj.5.2.0.7"</span>, which includes a version number. The
version number can be omitted in a <a href="#(tech._progid)" class="techoutside" pltdoc="x"><span class="techinside">ProgID</span></a>, in which case the
most recent available version is used. The operating system provides
a mapping between <a href="#(tech._progid)" class="techoutside" pltdoc="x"><span class="techinside">ProgIDs</span></a> and <a href="#(tech._clsid)" class="techoutside" pltdoc="x"><span class="techinside">CLSIDs</span></a> that is available
via <span class="RktSym"><a href="com-auto.html#(def._((lib._ffi/unsafe/com..rkt)._progid-~3eclsid))" class="RktValLink" pltdoc="x">progid-&gt;clsid</a></span> and <span class="RktSym"><a href="com-auto.html#(def._((lib._ffi/unsafe/com..rkt)._clsid-~3eprogid))" class="RktValLink" pltdoc="x">clsid-&gt;progid</a></span>.</p></li></ul><p>A <a href="#(tech._com._object)" class="techoutside" pltdoc="x"><span class="techinside">COM object</span></a> can be instantiated either on the local machine or
on a remote machine. The latter relies on the operating system&rsquo;s
<a name="(tech._dcom)"></a><span style="font-style: italic">DCOM</span> (distributed COM) support.</p><p>Each <a href="#(tech._com._object)" class="techoutside" pltdoc="x"><span class="techinside">COM object</span></a> supports some number of <a name="(tech._com._interface)"></a><span style="font-style: italic">COM
interfaces</span>. A <a href="#(tech._com._interface)" class="techoutside" pltdoc="x"><span class="techinside">COM interface</span></a> has a programmatic name, such as
<span class="stt">IDispatch</span>, that corresponds to a C-layer protocol. Each
interface also has an <a name="(tech._iid)"></a><span style="font-style: italic">IID</span> (interface id) that is represented
as a <a href="#(tech._guid)" class="techoutside" pltdoc="x"><span class="techinside">GUID</span></a> such as
<span class="RktVal">"{00020400-0000-0000-C000-000000000046}"</span>. Direct calls to COM
methods require extracting a suitable interface pointer from an object
using <span class="RktSym"><a href="com-intf.html#(def._((lib._ffi/unsafe/com..rkt)._.Query.Interface))" class="RktValLink" pltdoc="x">QueryInterface</a></span> and the desired <a href="#(tech._iid)" class="techoutside" pltdoc="x"><span class="techinside">IID</span></a>; the result
is effectively cast it to a pointer to a dispatch-table pointer, where
the dispatch table has a statically known size and foreign-function
content. The <span class="RktSym"><a href="com-intf.html#(form._((lib._ffi/unsafe/com..rkt)._define-com-interface))" class="RktStxLink" pltdoc="x">define-com-interface</a></span> form simplifies description
and use of interface pointers. The COM automation layer uses a fixed
number of reflection interfaces internally, notably <span class="stt">IDispatch</span>,
to call methods by name and with safe argument marshaling.</p><table cellspacing="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html" class="toclink" pltdoc="x">5.9.1<span class="hspace">&nbsp;</span>COM Automation</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#(part._.G.U.I.Ds__.C.L.S.I.Ds__.I.I.Ds__and_.Prog.I.Ds)" class="toclink" pltdoc="x">5.9.1.1<span class="hspace">&nbsp;</span>GUIDs, CLSIDs, IIDs, and ProgIDs</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#(part._.C.O.M_.Objects)" class="toclink" pltdoc="x">5.9.1.2<span class="hspace">&nbsp;</span>COM Objects</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#(part._.C.O.M_.Methods)" class="toclink" pltdoc="x">5.9.1.3<span class="hspace">&nbsp;</span>COM Methods</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#(part._.C.O.M_.Properties)" class="toclink" pltdoc="x">5.9.1.4<span class="hspace">&nbsp;</span>COM Properties</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#(part._.C.O.M_.Events)" class="toclink" pltdoc="x">5.9.1.5<span class="hspace">&nbsp;</span>COM Events</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#(part._.Interface_.Pointers)" class="toclink" pltdoc="x">5.9.1.6<span class="hspace">&nbsp;</span>Interface Pointers</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#(part._remote)" class="toclink" pltdoc="x">5.9.1.7<span class="hspace">&nbsp;</span>Remote COM servers (DCOM)</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#(part._com-types)" class="toclink" pltdoc="x">5.9.1.8<span class="hspace">&nbsp;</span>COM Types</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-auto.html#(part._.Class_.Display_.Names)" class="toclink" pltdoc="x">5.9.1.9<span class="hspace">&nbsp;</span>Class Display Names</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-intf.html" class="toclink" pltdoc="x">5.9.2<span class="hspace">&nbsp;</span>COM Classes and Interfaces</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-intf.html#(part._.Describing_.C.O.M_.Interfaces)" class="toclink" pltdoc="x">5.9.2.1<span class="hspace">&nbsp;</span>Describing COM Interfaces</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-intf.html#(part._.Obtaining_.C.O.M_.Interface_.References)" class="toclink" pltdoc="x">5.9.2.2<span class="hspace">&nbsp;</span>Obtaining COM Interface References</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-intf.html#(part._.C.O.M_.F.F.I_.Helpers)" class="toclink" pltdoc="x">5.9.2.3<span class="hspace">&nbsp;</span>COM FFI Helpers</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="com-intf.html#(part._com-intf-example)" class="toclink" pltdoc="x">5.9.2.4<span class="hspace">&nbsp;</span>COM Interface Example</a></p></td></tr></table><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;5.3&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }" /></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" pltdoc="x" onclick="return GotoPLTRoot(&quot;5.3&quot;);">top</a></span><span class="navright"><a href="Objective-C_FFI.html" title="backward to &quot;5.8 Objective-C FFI&quot;" pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Derived_Utilities.html" title="up to &quot;5 Derived Utilities&quot;" pltdoc="x">up</a>&nbsp;&nbsp;<a href="com-auto.html" title="forward to &quot;5.9.1 COM Automation&quot;" pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>